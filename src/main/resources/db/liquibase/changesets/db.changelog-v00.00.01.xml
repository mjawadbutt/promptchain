<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.17.xsd">

  <changeSet id="v0.0.1-create-role-table" author="jawad">
    <createTable tableName="role">
      <column name="role_id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="role_name" type="VARCHAR(31)">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="role_description" type="VARCHAR(255)"/>
    </createTable>
    <rollback>
      <dropTable tableName="role"/>
    </rollback>
  </changeSet>

  <changeSet id="v0.0.1-create-user-group-table" author="jawad">
    <createTable tableName="user_group">
      <column name="group_id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="group_name" type="VARCHAR(31)">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="group_description" type="VARCHAR(255)"/>
    </createTable>
    <rollback>
      <dropTable tableName="user_group"/>
    </rollback>
  </changeSet>

  <changeSet id="v0.0.1-create-role-group-mapping-table" author="jawad">
    <createTable tableName="role_group_mapping">
      <column name="role_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="group_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="role_group_mapping" columnNames="role_id, group_id"
                   constraintName="pk_role_group_mapping"/>
    <addForeignKeyConstraint baseTableName="role_group_mapping"
                             baseColumnNames="role_id"
                             constraintName="fk_rgm_role"
                             referencedTableName="role"
                             referencedColumnNames="role_id"
                             onUpdate="RESTRICT"
                             onDelete="CASCADE"/>
    <addForeignKeyConstraint baseTableName="role_group_mapping"
                             baseColumnNames="group_id"
                             constraintName="fk_rgm_group"
                             referencedTableName="user_group"
                             referencedColumnNames="group_id"
                             onUpdate="RESTRICT"
                             onDelete="CASCADE"/>
    <rollback>
      <dropTable tableName="role_group_mapping"/>
    </rollback>
  </changeSet>

  <changeSet id="v0.0.1-create-user-table" author="jawad">
    <createTable tableName="user">
      <column name="user_id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="user_email" type="VARCHAR(127)">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="password" type="VARCHAR(31)">
        <constraints nullable="false"/>
      </column>
      <column name="user_name" type="VARCHAR(31)">
        <constraints nullable="false"/>
      </column>
      <column name="created_at" type="TIMESTAMP WITHOUT TIME ZONE" defaultValueComputed="NOW()">
        <constraints nullable="false"/>
      </column>
      <column name="last_updated_at" type="TIMESTAMP WITHOUT TIME ZONE" defaultValueComputed="NOW()">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <rollback>
      <dropTable tableName="user"/>
    </rollback>
  </changeSet>

  <changeSet id="v0.0.1-create-user-group-mapping-table" author="jawad">
    <createTable tableName="user_group_mapping">
      <column name="user_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="group_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="user_group_mapping" columnNames="user_id, group_id"
                   constraintName="pk_user_group_mapping"/>
    <addForeignKeyConstraint baseTableName="user_group_mapping"
                             baseColumnNames="user_id"
                             constraintName="fk_ugm_user"
                             referencedTableName="user"
                             referencedColumnNames="user_id"
                             onUpdate="RESTRICT"
                             onDelete="CASCADE"/>
    <addForeignKeyConstraint baseTableName="user_group_mapping"
                             baseColumnNames="group_id"
                             constraintName="fk_ugm_group"
                             referencedTableName="user_group"
                             referencedColumnNames="group_id"
                             onUpdate="RESTRICT"
                             onDelete="CASCADE"/>
    <rollback>
      <dropTable tableName="user_group_mapping"/>
    </rollback>
  </changeSet>

</databaseChangeLog>

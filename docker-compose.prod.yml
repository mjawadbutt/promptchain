# docker-compose.prod.yml
version: "3.9"

services:
  app:
    image: ghcr.io/${GHCRIO_USERNAME}/your-artifact-id:latest
    environment:
      - DEBUG_ENABLED=false
      - JAVA_OPTS=-Xms256m -Xmx1g
      - POSTGRES_USER=myappuser_prod # User for app in production
      - POSTGRES_PASSWORD=myappsecret_prod # Password for app in production (future Vault)
    deploy:
      replicas: 2
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 30s

  redis:
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 30s

  postgres:
    image: postgres:15 # Standard PostgreSQL image
    environment:
      # Password for the default 'postgres' superuser in production (future Vault)
      - POSTGRES_PASSWORD=my_super_secret_prod
    volumes:
      - postgres_data:/var/lib/postgresql/data
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 30s
      placement:
        constraints:
          - node.labels.type == database

# Removed: db-init service is entirely absent from production setup

networks:
  app-net:
    driver: overlay # Use overlay network for Docker Swarm